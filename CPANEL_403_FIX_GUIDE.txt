# cPanel 403 Forbidden - Complete Manual Fix Guide

## Issue
Getting 403 Forbidden error when accessing edit pages on cPanel hosting with LiteSpeed Web Server.

## Root Causes (Check in order)

### 1. File Permissions (MOST COMMON)
**Problem**: Files/directories have wrong permissions blocking web server access

**Fix via cPanel**:
1. Log in to cPanel
2. Go to: **File Manager**
3. Click on **public_html** folder
4. Right-click → **Change Permissions**
5. Set to: **755** for directories
6. Then select all files → Set to: **644**

**Fix via Terminal/SSH**:
```bash
cd ~/public_html
find . -type d -exec chmod 755 {} \;
find . -type f -exec chmod 644 {} \;
```

**Expected result**: All files readable by web server (755 for dirs, 644 for files)

---

### 2. .htaccess Issues
**Problem**: .htaccess is blocking access or has wrong syntax

**Check in cPanel**:
1. File Manager
2. Click **Settings** (top right)
3. Enable: **Show Hidden Files**
4. Look for `.htaccess` in public_html
5. If exists, right-click → **Edit**
6. Check syntax for errors

**Fix**:
- Create new .htaccess with correct content
- Set permissions to 644
- Ensure no syntax errors

**If .htaccess is problem**:
1. Temporarily rename: `.htaccess` → `.htaccess.backup`
2. Test if pages work
3. If yes, .htaccess was the issue
4. Then create new one with correct config

---

### 3. Session Directory Issues
**Problem**: PHP can't write session files

**Fix in cPanel**:
1. Go to: **Softaculous Apps Installer** → **PHP Settings**
2. Set **session.save_path** to: `/tmp`
3. Save settings

**Or edit .htaccess**:
```apache
php_value session.save_path "/tmp"
```

**Or via SSH**:
```bash
# Ensure /tmp is writable
chmod 1777 /tmp
# Create custom session directory
mkdir -p ~/session_tmp
chmod 755 ~/session_tmp
```

---

### 4. PHP Version/Handler Issues
**Problem**: Wrong PHP version or handler selected

**Fix in cPanel**:
1. Go to: **Select PHP Version**
2. Choose: **PHP 7.4.33** or higher
3. Click **Next**
4. Handler: Select **suPHP** (not DSO if security issues)
5. Enable Extensions: **mysqli**, **pdo_mysql**, **json**
6. Save

**Or try PHP-FPM**:
1. Same location
2. Select: **PHP 7.4 PHP-FPM 74**
3. Save

---

### 5. mod_security Blocking Requests
**Problem**: cPanel mod_security is blocking POST requests

**Check/Fix**:
1. Go to: **ModSecurity Tools** (or **Mod Security**)
2. Click: **Manage Rules**
3. Look for rules affecting: `/edit.php`, `/delete.php`
4. If found, disable those rules
5. Test

**Or whitelist your domain**:
```
ModSecurity whitelist rules for: yourdomain.com
```

---

### 6. Database Connection Issues
**Problem**: Can't connect to database = 403 after redirect

**Check**:
1. SSH/Terminal:
```bash
mysql -h localhost -u zxtfmwrs_zxtfmwrs -p'ws;0V;5YG2p0Az' zxtfmwrs_mnr_course
```

2. If fails, database credentials are wrong
3. Fix in: `/public_html/includes/config.php`

**Or via cPanel**:
1. Go to: **MySQL Databases**
2. Verify database exists: `zxtfmwrs_mnr_course`
3. Verify user exists: `zxtfmwrs_zxtfmwrs`
4. Check password is correct

---

### 7. Firewall/IP Restrictions
**Problem**: Server firewall blocking requests

**Check in cPanel**:
1. Go to: **Security** → **IP Whitelist**
2. If you have IPs listed, add your IP
3. Remove if too restrictive

**Or check server firewall**:
```bash
sudo iptables -L
# May need to contact hosting to adjust
```

---

### 8. DirectoryIndex Issue
**Problem**: DirectoryIndex missing index.php

**Fix in .htaccess**:
```apache
DirectoryIndex index.php index.html index.htm
```

---

## Step-by-Step Diagnostic

### Step 1: Run Diagnostic Page
```
Visit: https://your-domain.com/cpanel-diagnose.php
```
Note any ✗ (red) entries

### Step 2: Check Logs
```bash
# SSH into server
tail -f ~/public_html/logs/php-errors.log
tail -f /usr/local/apache/logs/error_log
# For LiteSpeed:
tail -f /usr/local/lsws/logs/error.log
```

### Step 3: Test Each Page
```
https://domain.com/index.php → works?
https://domain.com/login.php → works?
https://domain.com/edit.php?uuid=... → 403?
```

### Step 4: Test Form Submission
1. Go to working page
2. Try to submit a form
3. If 403, POST is blocked

### Step 5: Check Permissions Recursively
```bash
ssh user@server
cd ~/public_html
ls -la | head  # Check top-level perms
ls -la includes/
ls -la api/
ls -la logs/
```

---

## Quick Fix Checklist

- [ ] Visit cpanel-diagnose.php and note any failures
- [ ] Set directory permissions to 755
- [ ] Set file permissions to 644
- [ ] Verify .htaccess exists and has 644 permissions
- [ ] Check PHP version is 7.4+
- [ ] Enable mysqli extension
- [ ] Set session.save_path to /tmp
- [ ] Test database connection
- [ ] Check ModSecurity rules
- [ ] Try disabling .htaccess temporarily
- [ ] Check server firewall rules
- [ ] Test with direct UUID URL: edit.php?uuid=2411231830

---

## If Still Getting 403

1. **Contact cPanel Support** with:
   - Output from `/cpanel-diagnose.php`
   - Error logs from `/logs/php-errors.log`
   - Request: "Why am I getting 403 on POST requests to edit.php?"

2. **Check ModSecurity specifically**:
   - Ask: "Are ModSecurity rules blocking my forms?"
   - Ask: "Can you whitelist my domain for POST requests?"

3. **Ask for PHP-FPM enablement**:
   - If suPHP is used, try PHP-FPM
   - Ask: "Can you change my handler to PHP-FPM?"

4. **Check LiteSpeed configuration**:
   - If on LiteSpeed not Apache
   - Ask: "Is LiteSpeed configured to allow POST to PHP files?"

---

## Files Added

- `.htaccess` - Web server configuration
- `cpanel-diagnose.php` - Diagnostic tool
- `includes/error-handler.php` - Error handling
- `fix-cpanel-403.sh` - Bash fix script
- `logs/` - Error logs directory

---

## URLs to Test

```
https://domain.com/index.php                    → Dashboard
https://domain.com/login.php                    → Login
https://domain.com/cpanel-diagnose.php          → Diagnostics
https://domain.com/edit.php?uuid=2411231830    → Edit (test URL)
https://domain.com/view.php?uuid=2411231830    → View (test URL)
```

---

## Next Steps After Fix

1. If diagnostic passes, clear browser cache
2. Log out and log back in
3. Try editing a question
4. Check for success message
5. If still issues, run diagnostic again

---

**For cPanel hosting on LiteSpeed with PHP 7.4+**
Last Updated: 2025-11-23
